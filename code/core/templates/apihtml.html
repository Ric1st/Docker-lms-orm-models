<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard API Data</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container mt-5">
        <h1>Test API</h1>
        <!-- =============================== -->
        <!-- USERS TABLE -->
        <!-- =============================== -->
        <div class="card shadow mb-5">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Daftar User</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Nama Depan</th>
                                <th>Nama Belakang</th>
                                <th>Email</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <tr>
                                <td colspan="5" class="text-center">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- =============================== -->
        <!-- COURSES TABLE -->
        <!-- =============================== -->
        <div class="card shadow mb-5">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">Daftar Kursus</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Nama</th>
                                <th>Deskripsi</th>
                                <th>Harga</th>
                                <th>Teacher ID</th>
                            </tr>
                        </thead>
                        <tbody id="courseTableBody">
                            <tr>
                                <td colspan="5" class="text-center">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- =============================== -->
        <!-- MEMBERS TABLE -->
        <!-- =============================== -->
        <div class="card shadow mb-5">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">Daftar Member</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>User ID</th>
                                <th>Roles</th>
                            </tr>
                        </thead>
                        <tbody id="memberTableBody">
                            <tr>
                                <td colspan="3" class="text-center">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- =============================== -->
        <!-- CONTENTS TABLE -->
        <!-- =============================== -->
        <div class="card shadow mb-5">
            <div class="card-header bg-warning text-white">
                <h4 class="mb-0">Daftar Konten Kursus</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Course ID</th>
                                <th>Nama</th>
                                <th>Deskripsi</th>
                                <th>Video URL</th>
                                <th>Attachment</th>
                            </tr>
                        </thead>
                        <tbody id="contentTableBody">
                            <tr>
                                <td colspan="6" class="text-center">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- =============================== -->
        <!-- COMMENTS TABLE -->
        <!-- =============================== -->
        <div class="card shadow mb-5">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">Komentar</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Content ID</th>
                                <th>Member ID</th>
                                <th>Komentar</th>
                            </tr>
                        </thead>
                        <tbody id="commentTableBody">
                            <tr>
                                <td colspan="4" class="text-center">Memuat data...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ============================================= -->
    <!-- FETCH DATA JAVASCRIPT -->
    <!-- ============================================= -->
    <script>
        // ================= USERS =================
        async function loadUsers() {
            try {
                const res = await fetch("/api/v1/users");
                const data = await res.json();

                data.sort((a, b) => a.id - b.id); // Sort ASC

                const body = document.getElementById("userTableBody");
                body.innerHTML = "";

                data.forEach(u => {
                    body.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${u.id}</td>
                            <td>${u.username}</td>
                            <td>${u.first_name}</td>
                            <td>${u.last_name}</td>
                            <td>${u.email}</td>
                        </tr>
                    `);
                });
            } catch {
                document.getElementById("userTableBody").innerHTML =
                    `<tr><td colspan="5" class="text-center text-danger">Gagal memuat data</td></tr>`;
            }
        }

        // ================= COURSES =================
        async function loadCourses() {
            try {
                const res = await fetch("/api/v1/courses");
                const data = await res.json();

                const body = document.getElementById("courseTableBody");
                body.innerHTML = "";

                data.forEach(c => {
                    body.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${c.id}</td>
                            <td>${c.name}</td>
                            <td>${c.description}</td>
                            <td>${c.price}</td>
                            <td>${c.teacher}</td>
                        </tr>
                    `);
                });
            } catch {
                document.getElementById("courseTableBody").innerHTML =
                    `<tr><td colspan="5" class="text-center text-danger">Gagal memuat data</td></tr>`;
            }
        }

        // ================= MEMBERS =================
        async function loadMembers() {
            try {
                const res = await fetch("/api/v1/members");
                const data = await res.json();

                const body = document.getElementById("memberTableBody");
                body.innerHTML = "";

                data.forEach(m => {
                    body.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${m.id}</td>
                            <td>${m.user_id}</td>
                            <td>${m.roles}</td>
                        </tr>
                    `);
                });
            } catch {
                document.getElementById("memberTableBody").innerHTML =
                    `<tr><td colspan="3" class="text-center text-danger">Gagal memuat data</td></tr>`;
            }
        }

        // ================= CONTENTS =================
        async function loadContents() {
            try {
                const res = await fetch("/api/v1/contents");
                const data = await res.json();

                const body = document.getElementById("contentTableBody");
                body.innerHTML = "";

                data.forEach(c => {
                    body.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${c.id}</td>
                            <td>${c.course_id}</td>
                            <td>${c.name}</td>
                            <td>${c.description}</td>
                            <td>${c.video_url}</td>
                            <td>${c.file_attachment ?? "-"}</td>
                        </tr>
                    `);
                });
            } catch {
                document.getElementById("contentTableBody").innerHTML =
                    `<tr><td colspan="6" class="text-center text-danger">Gagal memuat data</td></tr>`;
            }
        }

        // ================= COMMENTS =================
        async function loadComments() {
            try {
                const res = await fetch("/api/v1/comments");
                const data = await res.json();

                const body = document.getElementById("commentTableBody");
                body.innerHTML = "";

                data.forEach(c => {
                    body.insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>${c.id}</td>
                            <td>${c.content_id}</td>
                            <td>${c.member_id}</td>
                            <td>${c.comment}</td>
                        </tr>
                    `);
                });
            } catch {
                document.getElementById("commentTableBody").innerHTML =
                    `<tr><td colspan="4" class="text-center text-danger">Gagal memuat data</td></tr>`;
            }
        }

        // ================= LOAD ALL ON PAGE LOAD =================
        loadUsers();
        loadCourses();
        loadMembers();
        loadContents();
        loadComments();
    </script>

</body>

</html>